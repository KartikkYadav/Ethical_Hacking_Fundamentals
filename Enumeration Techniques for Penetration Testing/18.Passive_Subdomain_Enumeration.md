
# Passive Subdomain Enumeration

Passive subdomain enumeration involves gathering subdomain information without directly querying the target's infrastructure. This reduces the chance of detection.

## Table of Contents

- [WHOIS Lookup](#whois-lookup)
- [Reverse WHOIS](#reverse-whois)
- [Google Analytics Relationship](#google-analytics-relationship)
- [Certificate Transparency (CT) Logs](#certificate-transparency-ct-logs)
- [Extract Subdomains from SAN](#extract-subdomains-from-san-subject-alternative-names)
- [VirusTotal](#virustotal)
- [Google Dorks](#google-dorks)
- [Shodan and Censys](#shodan-and-censys)
- [Rapid7 Sonar Datasets](#rapid7-sonar-datasets)
- [Chaos (ProjectDiscovery)](#chaos-projectdiscovery)

## WHOIS Lookup

Used to gather information about the registrant, name servers, and contact details.

    whois armourinfosec.com

- Web tools:

      https://who.is
      
      https://who.godaddy.com
      
      https://www.whoxy.com/reverse-whois/

### Reverse WHOIS

Find all domains registered with the same registrant or contact details.

### Web tools:

- https://viewdns.info/reversewhois/

- https://www.reversewhois.io/

- https://www.whoxy.com/reverse-whois/

### Google Analytics Relationship

- Use Google Analytics IDs to find related domains.
- https://builtwith.com/relationships/tesla.com

### Certificate Transparency (CT) Logs

- Collect subdomains from SSL/TLS certificates.

### Web tools:

- https://crt.sh

- https://censys.io

- https://developers.facebook.com

- https://transparencyreport.google.com

- https://sslmate.com/certspotter

### Example using crt.sh:

    curl -s "https://crt.sh/?q=%.tesla.com&output=json" \
      | jq -r '.[].name_value' \
      | sed 's/\*\.//g' \
      | sort -u

### Example using jq and unfurl:

    
    curl "https://crt.sh/?q=%.tesla.com&output=json" -o tesla.com.json
    cat tesla.com.json | jq -r '.[].name_value' | unfurl -u domains > tesla.txt
    Extract Subdomains from SAN (Subject Alternative Names)
    Extract SAN data from certificates.

### Example using Nmap:

    nmap --script targets-asn --script-args targets-asn.asn=394161

### Python script:

    python san_subdomain_enum.py google.com

### VirusTotal

- Search for subdomain relationships in VirusTotal.

- https://www.virustotal.com/gui/domain/www.tesla.com/relations

### Google Dorks
Find subdomains using advanced search operators.

### Examples:

    site:tesla.*
    site:*.tesla.*
    site:tesla.com -www -shop -xapps -autodiscover

### hodan and Censys

- Find exposed services and subdomains.

### Web tools:

- https://censys.io

- https://www.shodan.io

- https://dnsdumpster.com

### Rapid7 Sonar Datasets

- Use Sonar datasets to find subdomains.

### Example:

- wget https://opendata.rapid7.com/sonar.fdns_v2/2021-05-28-1622160364-fdns_a.json.gz

      pv 2021-05-28-1622160364-fdns_a.json.gz \
        | pigz -dc \
        | grep -E "\.tesla\.com\"," \
        | jq -r ".name"

### Chaos (ProjectDiscovery)

- Discover subdomains using ProjectDiscovery Chaos datasets.

- Example script:

      vim Chaos-data.sh

### Chaos Project Discovery

- Discover subdomains using ProjectDiscovery Chaos datasets.

### Example Script

    vim Chaos-data.sh
    
    #!/bin/bash
    Outputdir=/tmp/d1
    mkdir -p $Outputdir/zipfiles
    mkdir -p $Outputdir/txtfiles
    wget "https://chaos-data.projectdiscovery.io/index.json" -O $Outputdir/index.json
    grep "URL" $Outputdir/index.json | sed 's/"URL": "//;s/",//' > $Outputdir/alltargets-zip.txt
    wget -P $Outputdir/zipfiles -i $Outputdir/alltargets-zip.txt
    unzip -d $Outputdir/txtfiles $Outputdir/zipfiles/*.zip
    cat $Outputdir/txtfiles/*.txt > $Outputdir/alltargets.txt
    rm -rf $Outputdir/zipfiles $Outputdir/txtfiles

### GitHub Subdomain Enumeration

Use GitHub to extract subdomains.

### Example using github-subdomains

    github-subdomains -d tesla.com -t <TOKEN>

### Subdomain Enumeration Tools

- Sublist3r

- Amass

- Assetfinder

- Findomain

- Altdns

- Gobuster

### Complete Automation Script
Example of a full automation script:

    
    #!/bin/bash
    DOMAIN=$1
    amass enum -passive -d $DOMAIN > $DOMAIN-subdomains.txt
    subfinder -d $DOMAIN >> $DOMAIN-subdomains.txt
    assetfinder --subs-only $DOMAIN >> $DOMAIN-subdomains.txt
    sort -u $DOMAIN-subdomains.txt > $DOMAIN-final.txt
    cat $DOMAIN-final.txt
