# DNS Subdomain Takeover

This document outlines a structured and practical methodology for detecting **DNS subdomain takeovers** using open-source tools such as **puredns, subfinder, massdns, dnsx, httpx, and nuclei**.

A **subdomain takeover** occurs when a DNS record (usually a **CNAME**) points to a third-party service (e.g., S3, Heroku, GitHub Pages), but the resource on that service is **unclaimed, deleted, or misconfigured**, allowing an attacker to claim it.

---

## Tools Used

- **puredns** – High-performance brute-force DNS enumeration  
- **subfinder** – Passive subdomain discovery  
- **massdns** – Bulk DNS resolution (CNAME, A, etc.)  
- **dnsx** – Fast DNS resolver and CNAME extractor  
- **httpx** – HTTP probing and service fingerprinting  
- **nuclei** – Vulnerability scanner with takeover templates  
- **takeover.py** – Python-based takeover detection script  

---

## 1. Subdomain Enumeration (Active + Passive)

### Passive Enumeration

    subfinder -d subdomaintakeovers.com -silent > subs_passive.txt

### Active Brute-Forcing

    puredns bruteforce \
    /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
    subdomaintakeovers.com \
    -r /opt/resolvers.txt \
    --skip-validation \
    -w subs_active.txt

### Combine and Deduplicate

    cat subs_passive.txt subs_active.txt | sort -u > subs_all.txt

### 2. Resolve CNAME Records
#### Using dnsx (Fast & Clean)

    dnsx -l subs_all.txt -silent -cname -resp -r /opt/resolvers.txt -o cname_raw.txt

#### Using massdns (Alternative)

    massdns -r /opt/resolvers.txt -t CNAME subs_all.txt -o S -w cname_massdns.txt

### 3. Filter External CNAMEs
#### Remove internal or self-referencing CNAMEs

    grep -vE "(subdomaintakeovers\.com\.$)" cname_raw.txt > cname_external.txt

#### Extract only subdomain names and normalize

    cut -d ' ' -f 1 cname_external.txt | sed 's/\.$//' > cname_hosts.txt

### 4. Noise Reduction (Optional but Recommended)
Exclude known owned infrastructure to reduce false positives:

    grep -vE "(cloudflare\.net|amazonaws\.com|cn|googleusercontent\.com)" \
    cname_hosts.txt > cname_filtered.txt

⚠️ This step is target-specific and should be adjusted per organization.

### 5. Scan for Takeovers Using Nuclei

    nuclei -list cname_filtered.txt \
    -t ~/nuclei-templates/takeovers \
    -severity low,medium,high

### Recommended Template Sources
- https://github.com/projectdiscovery/nuclei-templates
- https://github.com/EdOverflow/can-i-take-over-xyz

### 6. DNSX → Nuclei One-Liner

    dnsx -l subs_all.txt -silent -cname -resp-only | \
    nuclei -t ~/nuclei-templates/takeovers/

### 7. Probe HTTP Services
Identify live services and fingerprints:

    httpx -l subs_all.txt \
    -silent \
    -status-code \
    -title \
    -web-server \
    -tech-detect \
    -location

### Look for:
- 404 or service-specific error pages
- Messages like “No such bucket”, “There isn’t a GitHub Pages site here”
- Unclaimed or misconfigured third-party services

### Notes
- Always verify manually before reporting
- Do not attempt to claim resources without permission
- Follow responsible disclosure and bug bounty program rules
### Look For

- `404` or service-specific error pages  
- Messages like **"No such app"**, **"Bucket does not exist"**  
- Third-party branding without ownership  

---

## 8. Final Validation (Critical Step)

Before reporting a takeover:

1. Verify the service allows claiming  
2. Confirm there is no existing owner  
3. Cross-check against:  
   - https://github.com/EdOverflow/can-i-take-over-xyz  
4. Capture **HTTP + DNS + error response** evidence  

⚠️ **Never claim resources without written authorization.**

---

## 9. Python Automation (takeover.py)

    git clone https://github.com/antichown/subdomain-takeover
    cd subdomain-takeover
    pip install -r requirements.txt

- python takeover.py -d subdomaintakeovers.com -w cname_hosts.txt -t 20

### Example Takeover Candidates

    bucket.subdomaintakeovers.com   CNAME  bucket-test1.s3.amazonaws.com
    blog.subdomaintakeovers.com     CNAME  blog-test1.wordpress.com
    api.subdomaintakeovers.com      CNAME  myapi-test.ngrok.io

These should be manually verified to determine if the backing service is unclaimed.

### References

- https://github.com/EdOverflow/can-i-take-over-xyz
- https://docs.projectdiscovery.io
- https://owasp.org/www-community/attacks/Subdomain_takeover

### Notes for Reporting
- Severity is usually High if confirmed claimable
- Include DNS proof, HTTP proof, and service documentation
- Avoid speculative reporting without validation
