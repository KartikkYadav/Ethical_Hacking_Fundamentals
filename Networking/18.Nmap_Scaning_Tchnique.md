# Custom TCP Scan Flags in Nmap (`--scanflags`)

The `--scanflags` option in Nmap allows users to manually specify which TCP flags to set in probe packets, enabling full customization of scan behavior beyond the predefined scan types like SYN (`-sS`), FIN (`-sF`), or Xmas (`-sX`).

This feature gives advanced control over TCP scanning, allowing stealthier, evasive, or experimental scans by crafting custom TCP packets.

---

## Common Examples of `--scanflags`

### SYN Scan (`--scanflags=SYN`)

- Behaves similarly to the standard SYN scan (`-sS`).
- **Server responses:**
  - **Open port:** SYN/ACK response.
  - **Closed port:** RST/ACK response.
  - **Filtered port:** No response.

        nmap -v -p 23 --scanflags=SYN 192.168.1.46

    
---

### RST Scan (`--scanflags=RST`)

- Uncommon and generally ineffective.
- Most systems ignore or drop RST packets since they are used to immediately close TCP connections.
- Rarely reveals useful information.

      nmap -v -p 23 --scanflags=RST 192.168.1.46

  
---

### ACK Scan (`--scanflags=ACK`)

- Useful for mapping firewall rules and checking if a port is filtered.
- **Server responses:**
  - **Unfiltered port:** Sends RST (regardless of open or closed).
  - **Filtered port:** No response.

        nmap -v -p 23 --scanflags=ACK 192.168.1.46

    
---

### PSH Scan (`--scanflags=PSH`)

- Sends packets with the PSH (Push) flag set.
- This flag tells the receiver to process the packet immediately.
- Rarely triggers meaningful responses unless part of an established TCP session.

      nmap -v -p 23 --scanflags=PSH 192.168.1.51
  
---

### FIN Scan (`--scanflags=FIN`)

- Similar to the FIN scan (`-sF`).
- **Server responses:**
  - **Open port:** No response.
  - **Closed port:** RST/ACK response.
  - **Filtered port:** No response.

        nmap -v -p 23 --scanflags=FIN 192.168.1.51
    
---

## Combining Multiple TCP Flags

- You can combine multiple flags to create custom scan packets.
- Example sets SYN, FIN, and URG flags simultaneously.
- Useful for stealth or evasion against IDS/IPS systems.

        nmap -v -p 23 --scanflags=SYN,FIN,URG 192.168.1.51
  
---

## Use Cases for Custom Scan Flags

- **Bypassing Firewall Rules:** Custom flag combinations might evade firewalls that block common scans.
- **Testing IDS/IPS Detection:** Many intrusion detection systems detect the signature of standard scans but may not recognize unusual flag combinations.
- **Stealthy Reconnaissance:** Custom flags avoid resembling typical TCP connection patterns, reducing likelihood of logs or alarms.

Custom TCP flag scans allow penetration testers and network defenders to explore subtle protocol behaviors and evade detection mechanisms that rely on known scan patterns.


------------

# IP-Protocol-Scan (-sO)

## IP Protocol Scan (-sO)
The **IP Protocol Scan (-sO)** is a specialized Nmap scan that probes which IP protocols are supported by a target system. Instead of scanning TCP or UDP ports, it sends IP packets with specific protocol numbers (e.g., ICMP, GRE, ESP) to discover supported protocols, firewall rules, and network service capabilities.

---

## How the -sO Scan Works

### Open Protocol
- The client sends an IP packet with a specific protocol number (e.g., ICMP = 1, TCP = 6, UDP = 17).
- The server responds appropriately, confirming the protocol is supported.

**Flow:**
    
    Client IP Protocol -> Server
    Client <- Response (valid for that protocol) Server

    
### Closed Protocol
- The client sends an IP packet with a specific protocol number.
- The server replies with an **ICMP Protocol Unreachable** message (Type 3, Code 2), indicating the protocol is not supported.

**Flow:**

    Client IP Protocol -> Server
    Client <- ICMP Protocol Unreachable Server

### Filtered Protocol
- The client sends an IP packet with a specific protocol number.
- No response is received, suggesting the packet is filtered or blocked by firewall/security measures.

**Flow:**
    
    Client IP Protocol -> Server
    (no response)

    
---

## Advantages of IP Protocol Scan (-sO)

- Enumerates supported IP protocols beyond just TCP and UDP.
- Helps identify allowed or blocked protocols for firewall and security testing.
- Useful for firewalled hosts where TCP/UDP ports may all appear closed but other protocols remain accessible.

---

## Disadvantages of IP Protocol Scan (-sO)

- Requires **root/administrator privileges** to send raw IP packets.
- Provides limited detail; only indicates if a protocol is supported but not specific services.
- May trigger alerts or be blocked by intrusion detection or firewall systems.

---

## Use Cases

- Testing firewall policies to determine allowed/disallowed IP protocols.
- Detecting non-standard or tunneled communication methods (e.g., GRE, ESP).
- Recon on restricted or hardened networks to uncover hidden protocols.
- Identifying VPN tunnels or encrypted traffic support.

---

## Example Commands

    nmap -v -sO 192.168.1.51
    
    nmap -v -sO --packet-trace 192.168.1.51
    
    nmap -v -sO --disable-arp-ping 192.168.1.51
    
    nmap -v -sO -Pn 192.168.1.51

    
---

## Interpreting Scan Results

### Supported Protocols

If open, the protocol responds normally.

**Example:**
    
    Proto (1) open # ICMP supported
    Proto (6) open # TCP supported
    Proto (17) open # UDP supported


### Unsupported Protocols

If closed, the system sends ICMP "Protocol Unreachable" (Type 3, Code 2).

**Example:**

    Proto (47) closed # GRE not supported
    Proto (50) closed # ESP not supported

    
---

## Common IP Protocol Numbers

| Protocol | Number | Description                                |
|----------|--------|--------------------------------------------|
| ICMP     | 1      | Ping, network diagnostics                  |
| IGMP     | 2      | Multicast communication                    |
| TCP      | 6      | Reliable communication (HTTP, SSH)         |
| UDP      | 17     | Connectionless communication (DNS, VoIP)   |
| GRE      | 47     | VPN tunneling (e.g., PPTP)                 |
| ESP      | 50     | IPsec encryption                           |
| AH       | 51     | IPsec authentication                       |

---

The IP Protocol Scan expands reconnaissance capabilities beyond traditional port scanning, making it valuable for deep network security assessment.

