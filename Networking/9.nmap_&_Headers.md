# Nmap (Network Mapper)

Nmap is a powerful open-source tool for network discovery and security auditing.  

## Primary Uses

- **Host Discovery:** Identifies active devices and systems on a network.
- **Port Scanning:** Detects open ports and associated network services.
- **Service & Version Detection:** Determines the software and versions running on open ports, aiding in inventory and vulnerability checks.
- **OS Detection:** Identifies the operating system and version used by target devices.
- **Vulnerability Scanning:** Finds known security vulnerabilities by probing network services and analyzing responses.
- **Firewall & IDS Evasion:** Includes techniques to bypass security controls like firewalls and Intrusion Detection Systems, such as using decoys, fragmenting packets, or manipulating packet headers.

These features make Nmap invaluable for administrators, security professionals, and auditors seeking to secure and understand their networks.

## What is Nmap?

- **Purpose:** Nmap is an open-source utility for network discovery and security auditing. It maps networks by discovering hosts and services.
- **How it Works:** Sends specially crafted packets to target hosts and analyzes responses to identify hosts, services, operating systems, and firewall types.
- **Compatibility:** Runs on Linux, Windows, macOS, BSD, Solaris, etc., with command-line and GUI (Zenmap) interfaces.

## Key Features

- Supports advanced techniques including TCP, UDP, ICMP and IP protocol scans.
- Handles large network scans and single hosts efficiently.
- Includes Nmap Scripting Engine (NSE) for automated vulnerability detection.
- Widely used, awarded, and featured in films and publications.

## Nmap Installation Commands

### For Debian/Ubuntu-based Linux (APT)


apt install nmap

text

### For Red Hat/CentOS/Fedora-based Linux (YUM)

yum install nmap

text

### For UNIX Platforms (Solaris, FreeBSD, NetBSD, OpenBSD, etc.) — From Source

Download: `nmap-7.97.tar.bz2`

bzip2 -dc nmap-.tar.bz2 | tar xvf -
cd nmap-
./configure
make
make install

text
- Download the latest `nmap-*.tar.bz2` source package from the [official Nmap website].
- Use the commands above to extract, configure, compile, and install Nmap!

**Note:**
- Use `sudo` for commands that require administrative privileges.
- Package managers like `apt` and `yum` will handle dependencies automatically.
- Building from source is recommended for platforms where pre-compiled binaries are not available or if you need the latest version.

## Common Nmap Commands and Usage Examples

### Help and Usage Information

Show Help menu:

    nmap --help


Show shorter help:

    nmap -h



### Checking Nmap Version

To check the installed Nmap version:

    nmap -V

    or
    nmap --version


### Basic Scanning Examples

Scan a specific IP address:

    nmap 192.168.1.35


Scan by hostname or domain:

    nmap target.com


Scan with verbose output for detailed information:

    nmap -v 192.168.1.35


## Network Layer in Nmap

<img width="1244" height="312" alt="Screenshot From 2025-08-06 21-58-24" src="https://github.com/user-attachments/assets/4c85e19b-4a9d-4b50-a8e0-137f8cb02b49" />



The **Network Layer (Layer 3) of the OSI model** manages the movement and routing of packets across networks. Nmap leverages this layer for advanced network discovery and scanning.

### Network Packet OSI Model

| Physical & Data Link | Network | Transport | Session | Presentation | Application |
|---------------------|---------|-----------|---------|--------------|-------------|
| Header              | Data…   |           |         |              |             |
|                     | Header  | Data…     |         |              |             |
|                     |         | Header    | Data…   |              |             |
|                     |         |           | Header  | Data…        |             |
|                     |         |           |         | Header       | Data…       |
|                     |         |           |         |              | Header Data…|
| **NMAP**            |         |           |         |              |             |

### IP Packet Handling

- **Raw IP Packets:** Nmap sends raw IP packets to target hosts for scanning and to identify live systems.
- **ICMP Echo Requests:** Uses ping sweeps (ICMP) to discover active hosts.
- **Fragmented IP Packets:** Can send fragmented packets to help evade detection by firewalls and intrusion detection systems.

### Routing & Reachability

- **Route Selection:** Uses the network layer to determine optimal paths to targets.
- **Custom Gateways:** Allows specifying a gateway or source IP with options like `--source-ip` or `--route-dst`.

### Custom IP Packet Manipulation

- **Raw Packet Crafting:** Enables crafting custom IP packets for different scan types (`-sS`, `-sU`, `-sA`).
- **TTL Control:** Adjusts packet time-to-live (`--ttl`) to manage hop limits or for advanced probing.
- **Packet Fragmentation:** Uses the `-f` option to fragment packets, aiding in security evasion.

Let me know if you need any further enhancements or formatting for this Markdown!



## Firewall & IDS Evasion Techniques

- **Decoy Scanning (`-D`)**: Sends packets from spoofed addresses to conceal the real source.
- **Custom MTU (`--mtu`)**: Sets a custom maximum transmission unit to further complicate detection.

## IP Protocol Scan (`-sO`)

- **Protocol Discovery**: Lists all supported network-layer protocols available on a target by sending different types of protocol packets (useful for discovering lesser-known services and VPNs).

### Summary

Nmap’s network layer capabilities allow it to deftly probe, enumerate, and bypass network security measures, giving detailed visibility into both topology and host availability while providing multiple methods for stealth and evasion.

---

## Transport Layer in Nmap (Layer 4 – OSI Model)

The **Transport Layer (Layer 4)** is critical for end-to-end communication, reliability, and flow control between devices. Nmap leverages this layer extensively for scanning and analyzing network services and security. Here’s how:

### How Nmap Uses the Transport Layer

- **Port Scanning (TCP & UDP):**
  - Nmap’s core function at this layer is to check for open ports on a target system over both TCP and UDP.

#### TCP Scans

- **SYN Scan (`-sS`):** Known as a "half-open" scan, it sends SYN packets and waits for responses without completing the handshake, making it stealthy.
- **Connect Scan (`-sT`):** Completes the TCP three-way handshake, appearing as a standard connection request.
- **Null Scan (`-sN`):** Sends TCP packets with no flags set to test responses, often used for firewall evasion.

#### UDP Scans (`-sU`)

- Probes targets for open UDP ports such as DNS, SNMP, and TFTP.
- Because UDP doesn’t guarantee delivery, these scans can be slower and may require retransmissions.

#### Service Version Detection (`-sV`)

- After identifying open ports, Nmap interrogates them to determine the exact software and version in use.

#### TCP Flags & Firewall Evasion

- **FIN Scan (`-sF`):** Sends TCP packets with the FIN flag set to probe firewalls and closed ports.

### Summary

Nmap’s transport layer functionality enables detailed port and service scanning, OS fingerprinting, and stealthy probing, making it invaluable for network security assessments and audits. It combines multiple scanning methods and customizations to provide flexible, reliable, and efficient network enumeration.

---

## Transport Layer Scan Types with Examples

| Scan Type                 | Protocol   | Description                                      | Command Example                  |
|---------------------------|------------|--------------------------------------------------|----------------------------------|
| TCP SYN Scan              | TCP        | Stealth scan, doesn’t complete handshake         | `nmap -sS 192.168.1.1`           |
| TCP Connect Scan          | TCP        | Completes full handshake                         | `nmap -sT 192.168.1.1`           |
| UDP Scan                  | UDP        | Checks UDP ports like DNS, SNMP                  | `nmap -sU -p 53 192.168.1.1`     |
| Service Version Detection | TCP/UDP    | Identifies software versions running             | `nmap -sV 192.168.1.1`           |
| FIN Scan                  | TCP (Flag) | Sends FIN flag to probe ports                    | `nmap -sF 192.168.1.1`           |
| Xmas Scan                 | TCP (Flag) | Sends FIN, PSH, URG flags to probe               | `nmap -sX 192.168.1.1`           |

---

## IP (Internet Protocol) Header Fields and Their Role in Nmap Scans

Nmap manipulates key IP header fields to perform various scan types, optimize detection, and evade security controls. Below is a detailed explanation of important IP header fields and how Nmap uses them:

<img width="1167" height="230" alt="Screenshot From 2025-08-06 22-00-04" src="https://github.com/user-attachments/assets/750903b2-a096-42c9-806e-97e88a805cdf" />



### IP Header Structure

| ver/len | tos | total length           |
|---------|-----|-----------------------|
| id      |     | flags / fragment offset|
| time to live | protocol | checksum     |
| Source IP Address          |
| Destination IP Address     |
| Options...                 |

---

## IP Header Field Table

| #  | IP Header Field                  | Description & Role in Nmap                                                                                                                                       | Example Nmap Usage                                   |
|----|----------------------------------|--------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| 1  | Version                          | IP packet version—IPv4 (value 4) by default; IPv6 supported (`-6`).                                                      | `nmap -6 2001:db8::1` (IPv6 scan)                   |
| 2  | Header Length (IHL)              | Length of the IP header in 32-bit words (default 5 = 20 bytes); increases with options.                                   | Modified in raw protocol scans (`-sO`).              |
| 3  | Type of Service (ToS)/DSCP       | Quality of Service bits affecting packet handling/routing. Can be customized to influence traffic treatment or evade detection.  | `nmap --ip-options '\x83' 192.168.1.1`               |
| 4  | Total Length (Datagram Size)     | Combined header and payload length in bytes. Larger packets may require fragmentation.                                    | Packet fragmentation for firewall evasion with `-f`. |
| 5  | Identification                   | 16-bit field to uniquely identify packet fragments for reassembly. Useful in fragmentation evasion or traffic inspection.  | Visible in packet sniffing; manipulation with fragmentation enabled. |
| 6  | Flags                            | Control fragmentation. DF (Don’t Fragment), MF (More Fragments).                                                         | Fragmented scans with `-f` use these flags.          |
| 7  | Fragment Offset                  | Position of a fragment’s data relative to the original packet. Fragmentation can confuse some IDS/firewalls.              | Packet fragmentation can confuse detection systems.  |
| 8  | Time To Live (TTL)               | Limits packet lifetime (hops). Decremented at each router, preventing routing loops. Used for OS detection and trace route.| Set TTL (`--ttl`) to control detection or analyze network hops.    |
| 9  | Protocol                         | Specifies upper layer protocol (1=ICMP, 6=TCP, 17=UDP). Used in protocol scans.                                          | Protocol scan: `nmap -sO 192.168.1.1`                |
| 10 | Header Checksum                  | Validates the integrity of the IP header; recalculated with header changes.                                               | Calculated automatically; no user manipulation.      |
| 11 | Source Address                   | IP address of packet origin. Can be spoofed to conceal scan origin.                                                       | IP spoofing: `nmap -S 192.168.1.100 192.168.1.2`     |
| 12 | Destination Address              | IP of the target system(s). Supports single and subnet notation.                                                          | Examples: `192.168.1.1` or `192.168.1.0/24`          |
| 13 | Options                          | Rare extended features like Record Route, Timestamp. Can increase header size—uncommonly used but supported for advanced scans. | Custom options: `nmap --ip-options '\x07\x83\x7b' 192.168.1.1` |

---

If you need this split into different sections or want additional formatting, just let me know!

## TCP Header Fields & Their Role in Nmap Scans

The TCP header contains several fields that Nmap manipulates or analyzes to perform various scanning and evasion techniques. Understanding each field, and how Nmap leverages it, is key to understanding both basic and advanced Nmap scans.


<img width="1168" height="204" alt="Screenshot From 2025-08-06 22-01-44" src="https://github.com/user-attachments/assets/d1b35649-bd3e-4a6d-91c4-b9b35cef367c" />





### TCP Header Table

| source port            | destination port         |
|----------------------- |------------------------ |
| sequence number        |                         |
| acknowledgement number |                         |
| length/flags           | window size             |
| checksum               | urgent pointer          |

### Table: TCP Header Fields and Nmap Usage

| Field                  | Description & Nmap Usage                                                                                                             | Example Nmap Usage                                   |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| **Source Port**        | Port used by the sender. Can be manually set for evasion or bypassing filters.                                                      | `nmap --source-port 53 192.168.1.1`                  |
| **Destination Port**   | Target port(s) on the receiving host. Nmap scans specified ports or ranges.                                                         | `nmap -p 22,80,443 192.168.1.1`                      |
| **Sequence Number**    | Used for ordering TCP segments; analyzed during OS fingerprinting (`-O`).                                                           | Passive (OS fingerprinting)                          |
| **Acknowledgement Number** | Used in connection establishment (TCP handshake).                                                                              | Passive (three-way handshake)                        |
| **Data Offset**        | Specifies the length of the TCP header; increased by options.                                                                       | Passive                                              |
| **Reserved**           | Unused, reserved for future use.                                                                                                    | (not manipulated by Nmap)                            |
| **TCP Flags**          | Controls connection state. Nmap uses these for various scan types:<br>- URG (Urgent): Marks urgent data; rarely used.<br>- ACK (Acknowledgment): Used in ACK scans (`-sA`).<br>- PSH (Push): Rarely used.<br>- RST (Reset): Used in RST scan replies.<br>- SYN (Synchronize): Starts connections; SYN scans (`-sS`).<br>- FIN (Finish): FIN scans (`-sF`). | `nmap -sA 192.168.1.1`, `nmap -sS 192.168.1.1`, `nmap -sF 192.168.1.1`    |
| **Window Size**        | Indicates buffer size; analyzed for OS detection/fingerprinting.                                                                   | Passive                                              |

---

## How Nmap Uses TCP Header Fields

- **Source Port:**  
  You can set the source port manually with `--source-port`. This can improve state firewall evasion (for example, making scans use trusted ports like port 53 for DNS).
- **Destination Port:**  
  Chosen using `-p` (e.g., `-p 80,443` or `-p 1-1024`).
- **Sequence Number:**  
  Used by Nmap’s OS fingerprinting engine (`-O`). Passive analysis matches OS signatures to find sequence numbers' (ISN) uniformity.
- **Flags:**
    - **SYN Scan (`-sS`):** Sends SYN, waits for SYN-ACK or RST.
    - **FIN Scan (`-sF`):** Sends FIN, used for firewall evasion.
    - **ACK Scan (`-sA`):** Used to map firewall rules.
    - **Null/Xmas Scans:** Use no flags or combinations (e.g., FIN+URG+PSH).
- **Window Size:**  
  OS detection relies on TCP window size returned by open ports.
- **Options:**  
  Craft custom TCP packets using `--top-options` for advanced evasion or fingerprinting.

---

## UDP Header Fields & Their Role in Nmap Scans

The User Datagram Protocol (UDP) is a connectionless protocol at the transport layer, known for its speed and simplicity, but lacks reliability mechanisms found in TCP. This affects how Nmap conducts scans and the type of information it gathers.


<img width="1185" height="250" alt="Screenshot From 2025-08-06 22-02-56" src="https://github.com/user-attachments/assets/f05c349a-0a58-4877-90cf-6ea306f6ce02" />


### UDP Header Table

| source port        | destination port   |
|------------------- |------------------ |
| length             | checksum          |
| ephemeral high-numbered         | static well-known |
| 192.168.1.10 8223               | 192.168.1.100 512 |

### UDP Header Fields and Their Functions

| Field            | Size (Bits) | Description                                   | Nmap Relevance                                       |
|------------------|-------------|-----------------------------------------------|------------------------------------------------------|
| Source Port      | 16          | Port used by the sender's machine             | Can be set via `--source-port` to evade firewalls    |
| Destination Port | 16          | Target port on the receiver's machine         | Set with `-p`; defines which service is being scanned|
| Length           | 16          | Total size of UDP header plus data            | Used in fragmentation and evasion techniques         |
| Checksum         | 16          | Validates integrity of header and data        | May be set incorrectly for stealth/evasion           |

---

## How Nmap Uses UDP Header Fields in Scans

- **Source Port:**  
  You can specify the source port when scanning, which can help bypass firewall rules that allow traffic from "trusted" ports.

        nmap --source-port 53 -sU 192.168.1.1


This simulates legitimate DNS traffic.

- **Destination Port:**  
Nmap targets specific UDP ports or ranges using the `-p` option such as:

        nmap -sU -p 53,161,500 target.com


This is commonly used for scanning DNS (53), SNMP (161), or IKE (500).

- **Length Field:**  
The total length of the header and payload, which is important when crafting fragmented packets. Fragmentation may assist in bypassing certain security products or network controls.

- **Checksum:**  
Used for error checking, but Nmap might deliberately set incorrect values in rare stealth scenarios.

---

## Notes on UDP Scanning in Nmap

- UDP scanning (`-sU`) is typically slower and less reliable than TCP scanning.
- Unlike TCP, many services do not respond unless they accept the correct packet, and silent drops (no responses) are common.
- Nmap may retransmit UDP probes and interpret ICMP error messages (like "Port Unreachable") to confirm closed ports.

---

### Summary

Nmap manipulates UDP header fields—source port, destination port, length, and checksum—primarily for targeted scans, evasion tactics, and to adapt to stateless communication. This enables the discovery of UDP services and vulnerabilities, despite the protocol's inherent limitations and the scanning challenges it presents.

# Internet Control Message Protocol (ICMP) and Its Role in Nmap Scans

ICMP operates at the network (Layer 3) of the OSI model and is crucial for network diagnostics, error reporting, and control—not for data transfer. Nmap uses ICMP extensively to map networks and assess hosts and security devices.


<img width="1169" height="125" alt="Screenshot From 2025-08-06 22-05-20" src="https://github.com/user-attachments/assets/cbb166b2-afb1-4dc9-a639-1b946e110528" />



ICMP Header
+-------+-------+--------------------+
| type | code | checksum |
| type and code dependent |
+------------------------------------+


---

## ICMP Header Fields

| Field          | Size (Bits) | Description                                                                                   |
|----------------|-------------|-----------------------------------------------------------------------------------------------|
| Type           | 8           | Identifies the message kind (e.g., 8 = Echo Request, 0 = Echo Reply)                          |
| Code           | 8           | Extra info for the message type (e.g., reason for Destination Unreachable)                    |
| Checksum       | 16          | Error checking value for header/data integrity                                                 |
| Rest of Header | 32          | Varies; can include sequence numbers, identifiers, timestamps, etc.                           |

---

## Common ICMP Message Types and Use Cases

| Type | Code   | Message                       | Typical Use Case                                             |
|------|--------|-------------------------------|-------------------------------------------------------------|
| 0    | 0      | Echo Reply                    | Response to Echo Request (ping reply)                       |
| 3    | 0-15   | Destination Unreachable       | Reports unreachable target (port/host/network)               |
| 4    | 0      | Source Quench (deprecated)    | Request to slow down transmission                           |
| 5    | 0-3    | Redirect                      | Suggest alternate route for packets                         |
| 8    | 0      | Echo Request                  | Tests connectivity (ping sweep)                             |
| 11   | 0-1    | Time Exceeded                 | TTL expired in transit (used in traceroute)                 |
| 12   | 0-1    | Parameter Problem             | Indicates malformed IP header                               |

---

## How Nmap Uses ICMP

- **Echo Request (8) / Echo Reply (0):**
  - Used in Nmap’s ping sweeps (`-sn`), allowing rapid discovery of live hosts on a network.

- **Destination Unreachable (3):**
  - Interpreted by Nmap to help identify filtered or firewalled ports/services when scanning—if access to a port is blocked, a corresponding ICMP error may be generated.

- **Time Exceeded (11):**
  - Utilized in traceroute scans (`--traceroute`), to help map the network path/hop sequence from scanner to target.

- **Other Codes/Types:**  
  - Help Nmap detect network or host issues, recognize route changes, or spot filtering along the scan path.

**Summary:**  
ICMP gives Nmap the ability to perform effective network mapping, device discovery, and route analysis, making it an essential protocol for both administrators and security testers. Nmap leverages ICMP message types and header fields strategically to gather information and adapt to different network conditions and protections.

---

# Protocol Header Fields Manipulation in Nmap

| Protocol | Header Field     | Nmap Usage Description                                                                |
|----------|------------------|--------------------------------------------------------------------------------------|
| IP       | TTL              | OS detection and hop counting (`-O`, `--ttl`)                                        |
| IP       | Flags            | Fragmentation and stealth scans (`-f`)                                                |
| IP       | Source IP        | IP spoofing (`-S`)                                                                    |
| IP       | Protocol         | IP protocol scan (`-sO`)                                                              |
| TCP      | Flags            | Scan types (SYN, FIN, ACK, etc.) (`-sS`, `-sF`, `-sA`)                                |
| TCP      | Source Port      | Spoofing to evade firewalls (`--source-port`)                                         |
| TCP      | Destination Port | Target ports (`-p`)                                                                   |
| TCP      | Options          | Custom TCP packet crafting (`--top-options`)                                          |
| UDP      | Source Port      | Set source port to bypass filtering (`--source-port`)                                 |
| UDP      | Destination Port | Target UDP services (`-p`)                                                            |
| ICMP     | Type             | Used in ping and traceroute (Types 0, 3, 8, 11)                                      |
| ICMP     | Code             | Provides additional message info                                                      |

---

# TCP Three-Way Handshake in Nmap Scans

- **SYN:** Client initiates connection, sends initial sequence number.
- **SYN-ACK:** Server acknowledges and sends its sequence number.
- **ACK:** Client acknowledges server's sequence, connection established.

*Importance: Ensures reliable communication, sequence tracking for data integrity and filtering evasion.*

---




