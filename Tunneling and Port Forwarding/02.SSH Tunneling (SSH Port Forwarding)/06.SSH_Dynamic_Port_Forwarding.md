# SSH Dynamic Port Forwarding (SOCKS Proxy)

## SSH Dynamic Port Forwarding (SOCKS Proxy)

SSH Dynamic Port Forwarding creates a **SOCKS proxy** that dynamically routes traffic through an SSH server.

---

## Key Features

- Creates a **SOCKS4 / SOCKS5 proxy**
- Allows **dynamic routing of traffic**
- Commonly used for:
  - Anonymized browsing
  - Bypassing firewalls and network restrictions
  - Pivoting during penetration testing

---

## Syntax

    ssh -D [LOCAL_PORT] user@ssh_server

### Basic Example

    ssh -D 1080 user@remote_host
    
### This command:

- Starts a SOCKS proxy on localhost:1080
- Routes all proxy traffic through remote_host

### Lab Scenario
#### Network Layout

- Attacker (Kali / SSH Client): 192.168.1.7
- Target (SSH Server): 192.168.1.103
- Web Server: 192.168.2.100:80

### Command Used

    ssh -N -D 127.0.0.1:1080 armour@192.168.1.103

### Options Explained
- -N → Do not execute remote commands (tunnel only)
- -D 127.0.0.1:1080 → Bind SOCKS proxy to local address and port
- armour@192.168.1.103 → SSH user and target host

### Generic Syntax (Detailed)

    ssh -N -D <bind_address>:<bind_port> <username>@<ssh_server>

#### Additional Example

    ssh -N -D 127.0.0.1:1080 root@192.168.1.71

### Result

Once the SSH connection is established:
- A SOCKS proxy runs locally on 127.0.0.1:1080
- Applications configured to use this proxy will have their traffic:
  - Encrypted
  - Forwarded through the SSH server
 - Routed dynamically to any destination

## SSH Dynamic Port Forwarding in Windows
#### Steps
1. Download and install the PuTTY client on your Windows machine.
2. Enter the host name, port, and username for the SSH connection.
3. Navigate to Connection → SSH → Tunnels.
4. Enter a port (e.g., 1080) in the Source port field.
5. Select the Dynamic radio button.
6. Click Add.
7. Click Open to establish the SSH connection.
8. Once connected, a SOCKS proxy will run on the local machine at the specified port.

## SSH Dynamic Port Forwarding in Windows (PuTTY)
#### Prerequisites
- Windows system
- PuTTY SSH client installed

### Step-by-Step Configuration
1. Download and install PuTTY.
2. Launch PuTTY and open the Session screen.
3. Enter:
   - Host Name (or IP address)
   - Port (default: 22)
   - Connection type: SSH

4. Navigate to:

        Connection → SSH → Tunnels

### Configure the SOCKS Proxy
- Source port: 1080 (or any unused port)
- Select Dynamic
- Click Add

### (Optional) Save the Session
1. Go back to Session
2. Enter a name under Saved Sessions
3. Click Save

### Using ProxyChains with SSH Dynamic Port Forwarding
You can combine ProxyChains with SSH Dynamic Port Forwarding to securely route application traffic through an SSH tunnel.

Common use cases:

- Traffic anonymization
- Bypassing network restrictions
- Pivoting into internal networks during penetration testing

### Step 1: Establish an SSH Dynamic Port Forwarding Tunnel
    
    ssh -D 9050 -q -C -N user@remote_host

    ssh -D 9050 -q -T -N armour@192.168.1.25
    
    ssh -N -D 127.0.0.1:1080 armour@192.168.1.103

### Option Breakdown
- -D 9050 → Binds a SOCKS proxy to port 9050 on the local machine
- -q → Suppresses non-critical SSH output
- -C → Enables compression (useful on slow links)
- -N → Does not execute a remote command (tunnel only)

### Step 2: Install ProxyChains
    apt install proxychains

### Step 3: Configure ProxyChains
Edit the configuration file:

    vim /etc/proxychains.conf

Add or verify the following entry:

    socks4 127.0.0.1 9050

### Recommended Settings
Ensure the following options are enabled (uncommented):

    strict_chain     # Forces traffic to follow proxies in defined order
    proxy_dns        # Resolves DNS queries through the proxy

### Step 4: Use ProxyChains with the SSH Tunnel
Once the tunnel is active, prepend commands with proxychains.

###  Examples
HTTP Request

    proxychains curl http://192.168.2.100

### Network Scanning

    proxychains nmap -v -Pn -sT -n -p 80,445,443,3389 192.168.2.100

### Browser Traffic

    proxychains firefox

