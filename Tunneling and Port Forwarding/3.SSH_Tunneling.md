# SSH Tunneling

## SSH Tunneling (SSH Port Forwarding)

**SSH Tunneling**, also known as **SSH Port Forwarding**, is a technique that allows secure transmission of network traffic by encapsulating it inside an encrypted SSH connection.  
It is widely used in **system administration**, **penetration testing**, **red teaming**, and **secure remote access**.

---

## Why SSH Tunneling Is Important

- Encrypts otherwise plaintext protocols (HTTP, FTP, MySQL, etc.)
- Enables access to internal or restricted services
- Bypasses firewall and network restrictions
- Assists in lateral movement and pivoting
- Works reliably over untrusted networks

---

## How SSH Tunneling Works

SSH tunneling forwards traffic from a local or remote port through an SSH connection to a destination host and port.  
The SSH server acts as a secure intermediary, ensuring confidentiality and integrity.

---

## Types of SSH Tunneling

SSH provides **three primary port forwarding modes**:

- Local Port Forwarding
- Remote Port Forwarding
- Dynamic Port Forwarding (SOCKS Proxy)

---

# 1. SSH Local Port Forwarding

## Description

- Forwards traffic from a local port to a remote destination through an SSH server.
- Commonly used to access services that are only reachable from the SSH server’s network.


           Kali (127.0.0.1:PORT)
                │
                ▼
            SSH Tunnel
                │
                ▼
      WC01 (192.168.2.251 → 192.168.3.251)
                │
                ▼
      DC (192.168.3.250:SERVICE)





## Traffic Flow

#### Local Host → SSH Server → Target Service

    ssh -L [LOCAL_PORT]:[DESTINATION_HOST]:[DESTINATION_PORT] user@ssh_server

#### Example
  
    ssh -L 8080:192.168.1.100:80 user@remote_host

### Explanation

- Visiting http://localhost:8080
- Traffic is securely forwarded to 192.168.1.100:80 via remote_host

### Common Use Cases

- Accessing internal web applications
- Secure database access (MySQL, PostgreSQL)


         

## 2. SSH Remote Port Forwarding

### Description
- Forwards traffic from a remote port to a local service.
- Enables external systems to reach services running on the local machine.

         DC (192.168.3.250:SERVICE)
                 │
                 ▼
       WC01 (192.168.2.251 → 192.168.3.251)    
                 │
                 ▼
            SSH Tunnel
                 │
                 ▼
      Kali (127.0.0.1:PORT)




### Traffic Flow

    Remote Client → SSH Server → Local Service

### Syntax

    ssh -R [REMOTE_PORT]:[LOCAL_HOST]:[LOCAL_PORT] user@ssh_server

### Example

    ssh -R 9090:localhost:22 root@ssh_server

### xplanation

- Remote users connect to ssh_server:9090
- Traffic is forwarded to the local SSH service on port 22

### Common Use Cases

- Exposing local services behind NAT
- Reverse shells and persistence
- Temporary service sharing

## 3. SSH Dynamic Port Forwarding

### Description
- creates a local SOCKS proxy that dynamically routes traffic.
- Does not require specifying destination hosts or ports.

### Traffic Flow

    Application → SOCKS Proxy → SSH Server → Any Destination

### Syntax

    ssh -D [LOCAL_PORT] user@ssh_server

### Example

    ssh -D 1080 user@remote_host

### Explanation

- A SOCKS proxy is created at localhost:1080
- Applications configured to use this proxy send traffic via remote_host

### Common Use Cases
- Network pivoting
- Proxying tools like Burp Suite, Nmap, ProxyChains
- Anonymized browsing

## Advanced SSH Tunneling Options

### Background Tunneling
Run SSH tunneling in the background:

    ssh -f -N -L 8080:127.0.0.1:80 user@ssh_server

- -f runs SSH in background

- -N does not execute a remote command

### Bind to All Interfaces
- Allow remote systems to access forwarded ports:

      ssh -g -L 8080:127.0.0.1:80 user@ssh_server

## Remote Port Binding (GatewayPorts)
- Bind remote forwarded ports externally:

      ssh -R 0.0.0.0:9090:localhost:22 user@ssh_server

- Requires the following in sshd_config:

      GatewayPorts yes

  ## SSH Tunneling vs VPN

| Feature      | SSH Tunneling            | VPN                 |
|-------------|--------------------------|---------------------|
| Encryption  | Yes                      | Yes                 |
| Scope       | Per-port                 | Full network        |
| Setup       | Simple                   | Moderate            |
| Performance | Lightweight              | Heavier             |
| Use Case    | Pivoting, service access | Full network access |
